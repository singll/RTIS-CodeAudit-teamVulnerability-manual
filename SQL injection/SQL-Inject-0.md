## 说明
- 作者 | Author：singll
- 时间 | Date：2018/09/02
- 来源 | Source：<http://www.freebuf.com/vuls/178045.html>

## 代码
- 分类 | Category：SQL inject
- 语言 | Language：Java

```java
@Override
public PageBean<Notice> queryNotice(Notice notice, int pageCode, int pageSize) {
    PageBean<Notice> pb = new PageBean<Notice>(); //pageBean对象，用于分页
    //根据传入的pageCode当前页码和pageSize页面记录数来设置pb对象
    pb.setPageCode(pageCode); //设置当前页码
    pb.setPageSize(pageSize); //设置页面记录数

    StringBuilder sb = new StringBuilder();
    StringBuilder sb_sql = new StringBuilder();
    String sql = "SELECT count(*) FROM Notice n where 1=1"
    String hql = "from Notice n where 1=1";
    sb.append(hql);
    sb_sql.append(sql);
    if (!"".equals(notice.getNtitle().trim())) {
        sb.append(" and n.ntitle like '%" + notice.getNtitle() + "%' or n.ncontent like '%"); // @1
        sb_sql.append(" and n.ntitle like '%" + notice.getNtitle() + "%' or n.ncontent like '%"); //@2
    }
    //其他代码，包括执行sql语句的，由于源文章截图未截全，所以没有下面的代码
}
```

> 可以看到在@1与@2这两行，采用了拼接的方式将变量直接放到了SQL语句中。由于在拼接之前并没有对Ntitle进行过滤，而且Ntitle是从前端传过来的查询字段，所以此处存在SQL注入漏洞。

## 修复
参照《SQL注入漏洞修复方式-Java》