## 说明
- 作者 | Author：Time
- 时间 | Date：2018/09/10
- 来源 | Source：http://www.freebuf.com/articles/web/166602.html

## 代码
- 分类 | Category：SQL inject
- 语言 | Language：PHP

```php
define('IN_BLUE', true);
require_once dirname(__FILE__) . '/include/common.inc.php';
//此处接受get传递参数
$ad_id = !empty($_GET['ad_id']) ? trim($_GET['ad_id']) : '';
if(empty($ad_id)){
	echo 'Error!';
	exit();
}
//没有对ad_id进行过滤，直接带入数据库
$ad = $db->getone("SELECT * FROM ".table('ad')." WHERE ad_id =".$ad_id);
if($ad['time_set'] == 0){
	$ad_content = $ad['content'];
}
else{
	if($ad['end_time'] < time()){
		$ad_content = $ad['exp_content'];
	}
	else{
		$ad_content = $ad['content'];
	}
}
//此处为string字符过滤
$ad_content = str_replace('"', '\"',$ad_content);
$ad_content = str_replace("\r", "\\r",$ad_content);
$ad_content = str_replace("\n", "\\n",$ad_content);
echo "<!--\r\ndocument.write(\"".$ad_content."\");\r\n-->\r\n";
//由于ad_id是int类型，此处过滤的是字符型，所以存在int注入
```

> 直接获取get传递过来的参数进行判断，并且没有进行任何处理，直接带入数据库查询，在后面也只对string进行了一个处理，未对int进行处理，存在int类型的sql注入。

## 修复
​	建议在获取参数的时候做过滤，或在带入数据库的时候做处理。